from flask import Flask, jsonify, render_template
import json
import os
from collections import Counter

app = Flask(__name__)

DATA_FILE = os.path.join("data", "live_data.json")

@app.route("/")
def home():
    return render_template("index.html")

def read_packets():
    if not os.path.exists(DATA_FILE):
        return []
    try:
        with open(DATA_FILE, "r") as f:
            return json.load(f)
    except:
        return []

@app.route("/api/protocols")
def protocols():
    packets = read_packets()
    counts = Counter(p["protocol"] for p in packets)
    return jsonify(counts)

@app.route("/api/recent_packets")
def recent_packets():
    packets = read_packets()
    return jsonify(packets[-20:][::-1])  # last 20, newest first

if __name__ == "__main__":
    app.run(port=5000)

